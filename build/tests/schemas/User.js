"use strict";

var tap = require("tap");

var init = require("../init");
var User = init.User;

tap.test("password", { autoend: true }, function (t) {
    var user = init.getUser();

    user.password = "test";
    t.equal(user.password, "test");

    user.password = "";
    t.equal(user.password, "");
});

tap.test("authenticate", { autoend: true }, function (t) {
    var user = init.getUser();

    user.password = "test";

    t.equal(user.authenticate("test"), true);
    t.equal(user.authenticate("nottest"), false);
});

tap.test("validate", function (t) {
    var user = new User({
        email: "new@test.com",
        password: "test"
    });

    user.validate(function (err) {
        t.error(err);
        t.end();
    });
});

tap.test("validate (not new)", function (t) {
    var user = new User({
        email: "new@test.com",
        password: "test"
    });
    user.isNew = false;

    user.validate(function (err) {
        t.error(err);
        t.end();
    });
});

tap.test("validate (modified)", function (t) {
    var user = new User({
        email: "new@test.com",
        password: "test"
    });
    user.isNew = false;

    user.validate(function (err) {
        t.error(err);
        t.end();
    });
});

tap.test("validate (existing email)", function (t) {
    var user = new User({
        email: "test@test.com",
        password: "test"
    });

    user.validate(function (err) {
        t.equal(err.message, "User validation failed");
        t.end();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90ZXN0cy9zY2hlbWFzL1VzZXIuanMiXSwibmFtZXMiOlsidGFwIiwicmVxdWlyZSIsImluaXQiLCJVc2VyIiwidGVzdCIsImF1dG9lbmQiLCJ0IiwidXNlciIsImdldFVzZXIiLCJwYXNzd29yZCIsImVxdWFsIiwiYXV0aGVudGljYXRlIiwiZW1haWwiLCJ2YWxpZGF0ZSIsImVyciIsImVycm9yIiwiZW5kIiwiaXNOZXciLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLE1BQU1DLFFBQVEsS0FBUixDQUFaOztBQUVBLElBQU1DLE9BQU9ELFFBQVEsU0FBUixDQUFiO0FBQ0EsSUFBTUUsT0FBT0QsS0FBS0MsSUFBbEI7O0FBRUFILElBQUlJLElBQUosQ0FBUyxVQUFULEVBQXFCLEVBQUNDLFNBQVMsSUFBVixFQUFyQixFQUFzQyxVQUFDQyxDQUFELEVBQU87QUFDekMsUUFBTUMsT0FBT0wsS0FBS00sT0FBTCxFQUFiOztBQUVBRCxTQUFLRSxRQUFMLEdBQWdCLE1BQWhCO0FBQ0FILE1BQUVJLEtBQUYsQ0FBUUgsS0FBS0UsUUFBYixFQUF1QixNQUF2Qjs7QUFFQUYsU0FBS0UsUUFBTCxHQUFnQixFQUFoQjtBQUNBSCxNQUFFSSxLQUFGLENBQVFILEtBQUtFLFFBQWIsRUFBdUIsRUFBdkI7QUFDSCxDQVJEOztBQVVBVCxJQUFJSSxJQUFKLENBQVMsY0FBVCxFQUF5QixFQUFDQyxTQUFTLElBQVYsRUFBekIsRUFBMEMsVUFBQ0MsQ0FBRCxFQUFPO0FBQzdDLFFBQU1DLE9BQU9MLEtBQUtNLE9BQUwsRUFBYjs7QUFFQUQsU0FBS0UsUUFBTCxHQUFnQixNQUFoQjs7QUFFQUgsTUFBRUksS0FBRixDQUFRSCxLQUFLSSxZQUFMLENBQWtCLE1BQWxCLENBQVIsRUFBbUMsSUFBbkM7QUFDQUwsTUFBRUksS0FBRixDQUFRSCxLQUFLSSxZQUFMLENBQWtCLFNBQWxCLENBQVIsRUFBc0MsS0FBdEM7QUFDSCxDQVBEOztBQVNBWCxJQUFJSSxJQUFKLENBQVMsVUFBVCxFQUFxQixVQUFDRSxDQUFELEVBQU87QUFDeEIsUUFBTUMsT0FBTyxJQUFJSixJQUFKLENBQVM7QUFDbEJTLGVBQU8sY0FEVztBQUVsQkgsa0JBQVU7QUFGUSxLQUFULENBQWI7O0FBS0FGLFNBQUtNLFFBQUwsQ0FBYyxVQUFDQyxHQUFELEVBQVM7QUFDbkJSLFVBQUVTLEtBQUYsQ0FBUUQsR0FBUjtBQUNBUixVQUFFVSxHQUFGO0FBQ0gsS0FIRDtBQUlILENBVkQ7O0FBWUFoQixJQUFJSSxJQUFKLENBQVMsb0JBQVQsRUFBK0IsVUFBQ0UsQ0FBRCxFQUFPO0FBQ2xDLFFBQU1DLE9BQU8sSUFBSUosSUFBSixDQUFTO0FBQ2xCUyxlQUFPLGNBRFc7QUFFbEJILGtCQUFVO0FBRlEsS0FBVCxDQUFiO0FBSUFGLFNBQUtVLEtBQUwsR0FBYSxLQUFiOztBQUVBVixTQUFLTSxRQUFMLENBQWMsVUFBQ0MsR0FBRCxFQUFTO0FBQ25CUixVQUFFUyxLQUFGLENBQVFELEdBQVI7QUFDQVIsVUFBRVUsR0FBRjtBQUNILEtBSEQ7QUFJSCxDQVhEOztBQWFBaEIsSUFBSUksSUFBSixDQUFTLHFCQUFULEVBQWdDLFVBQUNFLENBQUQsRUFBTztBQUNuQyxRQUFNQyxPQUFPLElBQUlKLElBQUosQ0FBUztBQUNsQlMsZUFBTyxjQURXO0FBRWxCSCxrQkFBVTtBQUZRLEtBQVQsQ0FBYjtBQUlBRixTQUFLVSxLQUFMLEdBQWEsS0FBYjs7QUFFQVYsU0FBS00sUUFBTCxDQUFjLFVBQUNDLEdBQUQsRUFBUztBQUNuQlIsVUFBRVMsS0FBRixDQUFRRCxHQUFSO0FBQ0FSLFVBQUVVLEdBQUY7QUFDSCxLQUhEO0FBSUgsQ0FYRDs7QUFhQWhCLElBQUlJLElBQUosQ0FBUywyQkFBVCxFQUFzQyxVQUFDRSxDQUFELEVBQU87QUFDekMsUUFBTUMsT0FBTyxJQUFJSixJQUFKLENBQVM7QUFDbEJTLGVBQU8sZUFEVztBQUVsQkgsa0JBQVU7QUFGUSxLQUFULENBQWI7O0FBS0FGLFNBQUtNLFFBQUwsQ0FBYyxVQUFDQyxHQUFELEVBQVM7QUFDbkJSLFVBQUVJLEtBQUYsQ0FBUUksSUFBSUksT0FBWixFQUFxQix3QkFBckI7QUFDQVosVUFBRVUsR0FBRjtBQUNILEtBSEQ7QUFJSCxDQVZEIiwiZmlsZSI6IlVzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB0YXAgPSByZXF1aXJlKFwidGFwXCIpO1xuXG5jb25zdCBpbml0ID0gcmVxdWlyZShcIi4uL2luaXRcIik7XG5jb25zdCBVc2VyID0gaW5pdC5Vc2VyO1xuXG50YXAudGVzdChcInBhc3N3b3JkXCIsIHthdXRvZW5kOiB0cnVlfSwgKHQpID0+IHtcbiAgICBjb25zdCB1c2VyID0gaW5pdC5nZXRVc2VyKCk7XG5cbiAgICB1c2VyLnBhc3N3b3JkID0gXCJ0ZXN0XCI7XG4gICAgdC5lcXVhbCh1c2VyLnBhc3N3b3JkLCBcInRlc3RcIik7XG5cbiAgICB1c2VyLnBhc3N3b3JkID0gXCJcIjtcbiAgICB0LmVxdWFsKHVzZXIucGFzc3dvcmQsIFwiXCIpO1xufSk7XG5cbnRhcC50ZXN0KFwiYXV0aGVudGljYXRlXCIsIHthdXRvZW5kOiB0cnVlfSwgKHQpID0+IHtcbiAgICBjb25zdCB1c2VyID0gaW5pdC5nZXRVc2VyKCk7XG5cbiAgICB1c2VyLnBhc3N3b3JkID0gXCJ0ZXN0XCI7XG5cbiAgICB0LmVxdWFsKHVzZXIuYXV0aGVudGljYXRlKFwidGVzdFwiKSwgdHJ1ZSk7XG4gICAgdC5lcXVhbCh1c2VyLmF1dGhlbnRpY2F0ZShcIm5vdHRlc3RcIiksIGZhbHNlKTtcbn0pO1xuXG50YXAudGVzdChcInZhbGlkYXRlXCIsICh0KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKHtcbiAgICAgICAgZW1haWw6IFwibmV3QHRlc3QuY29tXCIsXG4gICAgICAgIHBhc3N3b3JkOiBcInRlc3RcIixcbiAgICB9KTtcblxuICAgIHVzZXIudmFsaWRhdGUoKGVycikgPT4ge1xuICAgICAgICB0LmVycm9yKGVycik7XG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxudGFwLnRlc3QoXCJ2YWxpZGF0ZSAobm90IG5ldylcIiwgKHQpID0+IHtcbiAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoe1xuICAgICAgICBlbWFpbDogXCJuZXdAdGVzdC5jb21cIixcbiAgICAgICAgcGFzc3dvcmQ6IFwidGVzdFwiLFxuICAgIH0pO1xuICAgIHVzZXIuaXNOZXcgPSBmYWxzZTtcblxuICAgIHVzZXIudmFsaWRhdGUoKGVycikgPT4ge1xuICAgICAgICB0LmVycm9yKGVycik7XG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxudGFwLnRlc3QoXCJ2YWxpZGF0ZSAobW9kaWZpZWQpXCIsICh0KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKHtcbiAgICAgICAgZW1haWw6IFwibmV3QHRlc3QuY29tXCIsXG4gICAgICAgIHBhc3N3b3JkOiBcInRlc3RcIixcbiAgICB9KTtcbiAgICB1c2VyLmlzTmV3ID0gZmFsc2U7XG5cbiAgICB1c2VyLnZhbGlkYXRlKChlcnIpID0+IHtcbiAgICAgICAgdC5lcnJvcihlcnIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwidmFsaWRhdGUgKGV4aXN0aW5nIGVtYWlsKVwiLCAodCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcih7XG4gICAgICAgIGVtYWlsOiBcInRlc3RAdGVzdC5jb21cIixcbiAgICAgICAgcGFzc3dvcmQ6IFwidGVzdFwiLFxuICAgIH0pO1xuXG4gICAgdXNlci52YWxpZGF0ZSgoZXJyKSA9PiB7XG4gICAgICAgIHQuZXF1YWwoZXJyLm1lc3NhZ2UsIFwiVXNlciB2YWxpZGF0aW9uIGZhaWxlZFwiKTtcbiAgICAgICAgdC5lbmQoKTtcbiAgICB9KTtcbn0pO1xuIl19