"use strict";

var path = require("path");

var tap = require("tap");

var init = require("../init");
var stub = init.stub;
var req = init.req;
var ImageImport = init.ImageImport;

tap.test("getURL", { autoend: true }, function (t) {
    var batch = init.getBatch();
    t.equal(batch.getURL(req.lang), "/artworks/source/test/admin?images=test/started", "Get URL");
});

tap.test("getSource", { autoend: true }, function (t) {
    var batch = init.getBatch();
    var source = init.getSource();
    t.equal(batch.getSource(), source, "Get Source");
});

tap.test("getCurState", { autoend: true }, function (t) {
    var batch = init.getBatch();
    var state = batch.getCurState();
    t.equal(state.id, "started", "Get State ID");
    t.equal(state.name(req), "Awaiting processing...", "Get State Name");
});

tap.test("getNextState", { autoend: true }, function (t) {
    var batch = init.getBatch();
    var state = batch.getNextState();
    t.equal(state.id, "process.started", "Get State ID");
    t.equal(state.name(req), "Processing...", "Get State Name");
});

tap.test("canAdvance", { autoend: true }, function (t) {
    var batch = init.getBatch();
    t.equal(batch.canAdvance(), true, "Check if state can advance");
});

tap.test("saveState", function (t) {
    var batch = init.getBatch();
    batch.saveState("process.started", function () {
        var state = batch.getCurState();
        t.equal(state.id, "process.started", "Get State ID");
        t.equal(state.name(req), "Processing...", "Get State Name");
        t.end();
    });
});

tap.test("getError", { autoend: true }, function (t) {
    var batch = init.getBatch();
    var errors = ["ERROR_READING_ZIP", "ZIP_FILE_EMPTY", "MALFORMED_IMAGE", "EMPTY_IMAGE", "NEW_VERSION", "TOO_SMALL", "ERROR_SAVING"];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = errors[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var error = _step.value;

            batch.error = error;
            t.ok(ImageImport.getError(req, batch.error), error);
            t.notEqual(ImageImport.getError(req, batch.error), error, error);
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }
});

tap.test("getFilteredResults", { autoend: true }, function (t) {
    var results = init.getBatches().map(function (batch) {
        return batch.getFilteredResults();
    });
    t.same(results[0], {
        errors: [],
        models: [],
        warnings: []
    });
    t.same(results[2], {
        "errors": [{
            "_id": "corrupted.jpg",
            "error": "MALFORMED_IMAGE",
            "fileName": "corrupted.jpg"
        }, {
            "_id": "empty.jpg",
            "error": "EMPTY_IMAGE",
            "fileName": "empty.jpg"
        }],
        "models": [{
            "_id": "bar.jpg",
            "fileName": "bar.jpg",
            "model": "test/bar.jpg",
            "warnings": []
        }, {
            "_id": "foo.jpg",
            "fileName": "foo.jpg",
            "model": "test/foo.jpg",
            "warnings": []
        }, {
            "_id": "new1.jpg",
            "fileName": "new1.jpg",
            "model": "test/new1.jpg",
            "warnings": []
        }, {
            "_id": "new2.jpg",
            "fileName": "new2.jpg",
            "model": "test/new2.jpg",
            "warnings": []
        }, {
            "_id": "small.jpg",
            "fileName": "small.jpg",
            "model": "test/small.jpg",
            "warnings": ["NEW_VERSION", "TOO_SMALL"]
        }, {
            "_id": "new3.jpg",
            "fileName": "new3.jpg",
            "model": "test/new3.jpg",
            "warnings": []
        }, {
            "_id": "nosimilar.jpg",
            "fileName": "nosimilar.jpg",
            "model": "test/nosimilar.jpg",
            "warnings": ["NEW_VERSION"]
        }],
        "warnings": [{
            "_id": "small.jpg",
            "fileName": "small.jpg",
            "model": "test/small.jpg",
            "warnings": ["NEW_VERSION", "TOO_SMALL"]
        }, {
            "_id": "nosimilar.jpg",
            "fileName": "nosimilar.jpg",
            "model": "test/nosimilar.jpg",
            "warnings": ["NEW_VERSION"]
        }]
    });
    t.same(results[5], {
        errors: [],
        models: [],
        warnings: []
    });
});

tap.test("validate", function (t) {
    var testZip = path.resolve(process.cwd(), "testData", "corrupted.zip");

    var batch = new ImageImport({
        _id: "test/corrupted",
        source: "test",
        zipFile: testZip,
        fileName: "corrupted.zip"
    });

    batch.validate(function (err) {
        t.error(err, "Error should be empty.");
        t.equal(batch._id, "test/corrupted", "ID should match");
        t.end();
    });
});

tap.test("validate", function (t) {
    var testZip = path.resolve(process.cwd(), "testData", "corrupted.zip");

    var batch = new ImageImport({
        source: "test",
        zipFile: testZip,
        fileName: "corrupted.zip"
    });

    batch.validate(function (err) {
        t.error(err, "Error should be empty.");
        t.ok(batch._id, "Should have an ID.");
        t.end();
    });
});

tap.test("processImages", function (t) {
    var batch = init.getBatch();
    batch.processImages(function (err) {
        t.error(err, "Error should be empty.");

        var expected = init.getImageResultsData();

        t.equal(batch.results.length, expected.length);
        expected.forEach(function (item, i) {
            t.same(batch.results[i], item);
        });

        t.end();
    });
});

tap.test("processImages (Corrupted File)", function (t) {
    var testZip = path.resolve(process.cwd(), "testData", "corrupted.zip");

    var batch = new ImageImport({
        _id: "test/started",
        source: "test",
        zipFile: testZip,
        fileName: "corrupted.zip"
    });

    batch.processImages(function (err) {
        t.ok(err, "Expecting an error");
        t.equal(err.message, "ERROR_READING_ZIP");
        t.end();
    });
});

tap.test("processImages (Empty File)", function (t) {
    var testZip = path.resolve(process.cwd(), "testData", "empty.zip");

    var batch = new ImageImport({
        _id: "test/started",
        source: "test",
        zipFile: testZip,
        fileName: "empty.zip"
    });

    batch.processImages(function (err) {
        t.ok(err, "Expecting an error");
        t.equal(err.message, "ZIP_FILE_EMPTY");
        t.end();
    });
});

tap.test("processImages (advance, started)", function (t) {
    var batch = init.getBatch();
    t.equal(batch.getCurState().name(req), "Awaiting processing...");
    batch.advance(function (err) {
        t.error(err, "Error should be empty.");

        var expected = init.getImageResultsData();

        t.equal(batch.results.length, expected.length);
        expected.forEach(function (item, i) {
            t.same(batch.results[i], item);
        });

        t.equal(batch.state, "process.completed");

        t.end();
    });
});

tap.test("processImages (advance, process.started)", function (t) {
    var batch = init.getBatches()[1];
    t.equal(batch.getCurState().name(req), "Processing...");
    batch.advance(function (err) {
        t.error(err, "Error should be empty.");
        t.equal(batch.results.length, 0);
        t.equal(batch.state, "process.started");
        t.end();
    });
});

tap.test("processImages (advance, process.completed)", function (t) {
    var batch = init.getBatches()[2];
    t.equal(batch.getCurState().name(req), "Completed.");
    batch.advance(function (err) {
        t.error(err, "Error should be empty.");

        var expected = init.getImageResultsData();

        t.equal(batch.results.length, expected.length);
        expected.forEach(function (item, i) {
            t.same(batch.results[i], item);
        });

        t.equal(batch.state, "completed");

        t.end();
    });
});

tap.test("processImages (advance, completed)", function (t) {
    var batch = init.getBatches()[4];
    t.equal(batch.getCurState().name(req), "Completed.");
    batch.advance(function (err) {
        t.error(err, "Error should be empty.");

        var expected = init.getImageResultsData();

        t.equal(batch.results.length, expected.length);
        expected.forEach(function (item, i) {
            t.same(batch.results[i], item);
        });

        t.equal(batch.state, "completed");

        t.end();
    });
});

tap.test("processImages (advance, error)", function (t) {
    var batch = init.getBatches()[5];
    t.notOk(batch.getCurState());
    batch.advance(function (err) {
        t.error(err, "Error should be empty.");
        t.equal(batch.results.length, 0);
        t.equal(batch.state, "error");
        t.end();
    });
});

tap.test("processImages (advance, Corrupted File)", function (t) {
    var testZip = path.resolve(process.cwd(), "testData", "corrupted.zip");

    var batch = new ImageImport({
        _id: "test/started",
        source: "test",
        zipFile: testZip,
        fileName: "corrupted.zip"
    });

    stub(batch, "save", process.nextTick);

    batch.advance(function (err) {
        t.error(err, "Error should be empty.");
        t.equal(batch.error, "ERROR_READING_ZIP");
        t.equal(batch.results.length, 0);
        t.equal(batch.state, "error");
        t.end();
    });
});

// NOTE(jeresig): Disabled as they intermittently fail on Travis CI
/*
// NOTE(jeresig): Increase the timeout as this test can take a while to run
tap.test("ImageImport.advance", {timeout: 20000}, (t) => {
    const checkStates = (batches, states) => {
        t.equal(batches.length, states.length);
        for (const batch of batches) {
            t.equal(batch.state, states.shift());
        }
    };

    const getBatches = (callback) => {
        ImageImport.find({}, "", {}, (err, batches) => {
            callback(null, batches.filter((batch) => (batch.state !== "error" &&
                batch.state !== "completed")));
        });
    };

    getBatches((err, batches) => {
        checkStates(batches,
            ["started", "process.started", "process.completed",
                "process.completed"]);

        ImageImport.advance((err) => {
            t.error(err, "Error should be empty.");

            getBatches((err, batches) => {
                checkStates(batches, ["process.completed", "process.started"]);

                ImageImport.advance((err) => {
                    t.error(err, "Error should be empty.");

                    getBatches((err, batches) => {
                        checkStates(batches, ["process.started"]);

                        // Force all batches to be completed
                        init.getBatches()[1].state = "completed";

                        ImageImport.advance((err) => {
                            t.error(err, "Error should be empty.");

                            getBatches((err, batches) => {
                                checkStates(batches, []);
                                t.end();
                            });
                        });
                    });
                });
            });
        });
    });
});
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90ZXN0cy9zY2hlbWFzL0ltYWdlSW1wb3J0LmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwidGFwIiwiaW5pdCIsInN0dWIiLCJyZXEiLCJJbWFnZUltcG9ydCIsInRlc3QiLCJhdXRvZW5kIiwidCIsImJhdGNoIiwiZ2V0QmF0Y2giLCJlcXVhbCIsImdldFVSTCIsImxhbmciLCJzb3VyY2UiLCJnZXRTb3VyY2UiLCJzdGF0ZSIsImdldEN1clN0YXRlIiwiaWQiLCJuYW1lIiwiZ2V0TmV4dFN0YXRlIiwiY2FuQWR2YW5jZSIsInNhdmVTdGF0ZSIsImVuZCIsImVycm9ycyIsImVycm9yIiwib2siLCJnZXRFcnJvciIsIm5vdEVxdWFsIiwicmVzdWx0cyIsImdldEJhdGNoZXMiLCJtYXAiLCJnZXRGaWx0ZXJlZFJlc3VsdHMiLCJzYW1lIiwibW9kZWxzIiwid2FybmluZ3MiLCJ0ZXN0WmlwIiwicmVzb2x2ZSIsInByb2Nlc3MiLCJjd2QiLCJfaWQiLCJ6aXBGaWxlIiwiZmlsZU5hbWUiLCJ2YWxpZGF0ZSIsImVyciIsInByb2Nlc3NJbWFnZXMiLCJleHBlY3RlZCIsImdldEltYWdlUmVzdWx0c0RhdGEiLCJsZW5ndGgiLCJmb3JFYWNoIiwiaXRlbSIsImkiLCJtZXNzYWdlIiwiYWR2YW5jZSIsIm5vdE9rIiwibmV4dFRpY2siXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7O0FBRUEsSUFBTUMsTUFBTUQsUUFBUSxLQUFSLENBQVo7O0FBRUEsSUFBTUUsT0FBT0YsUUFBUSxTQUFSLENBQWI7QUFDQSxJQUFNRyxPQUFPRCxLQUFLQyxJQUFsQjtBQUNBLElBQU1DLE1BQU1GLEtBQUtFLEdBQWpCO0FBQ0EsSUFBTUMsY0FBY0gsS0FBS0csV0FBekI7O0FBRUFKLElBQUlLLElBQUosQ0FBUyxRQUFULEVBQW1CLEVBQUNDLFNBQVMsSUFBVixFQUFuQixFQUFvQyxVQUFDQyxDQUFELEVBQU87QUFD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QXRCLElBQUlLLElBQUosQ0FBUyx5Q0FBVCxFQUFvRCxVQUFDRSxDQUFELEVBQU87QUFDdkQsUUFBTTRCLFVBQVVyQyxLQUFLc0MsT0FBTCxDQUFhQyxRQUFRQyxHQUFSLEVBQWIsRUFBNEIsVUFBNUIsRUFBd0MsZUFBeEMsQ0FBaEI7O0FBRUEsUUFBTTlCLFFBQVEsSUFBSUosV0FBSixDQUFnQjtBQUMxQm1DLGFBQUssY0FEcUI7QUFFMUIxQixnQkFBUSxNQUZrQjtBQUcxQjJCLGlCQUFTTCxPQUhpQjtBQUkxQk0sa0JBQVU7QUFKZ0IsS0FBaEIsQ0FBZDs7QUFPQXZDLFNBQUtNLEtBQUwsRUFBWSxNQUFaLEVBQW9CNkIsUUFBUWlCLFFBQTVCOztBQUVBOUMsVUFBTTRDLE9BQU4sQ0FBYyxVQUFDVCxHQUFELEVBQVM7QUFDbkJwQyxVQUFFaUIsS0FBRixDQUFRbUIsR0FBUixFQUFhLHdCQUFiO0FBQ0FwQyxVQUFFRyxLQUFGLENBQVFGLE1BQU1nQixLQUFkLEVBQXFCLG1CQUFyQjtBQUNBakIsVUFBRUcsS0FBRixDQUFRRixNQUFNb0IsT0FBTixDQUFjbUIsTUFBdEIsRUFBOEIsQ0FBOUI7QUFDQXhDLFVBQUVHLEtBQUYsQ0FBUUYsTUFBTU8sS0FBZCxFQUFxQixPQUFyQjtBQUNBUixVQUFFZSxHQUFGO0FBQ0gsS0FORDtBQU9ILENBbkJEOztBQXFCQTtBQUNBIiwiZmlsZSI6IkltYWdlSW1wb3J0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuXG5jb25zdCB0YXAgPSByZXF1aXJlKFwidGFwXCIpO1xuXG5jb25zdCBpbml0ID0gcmVxdWlyZShcIi4uL2luaXRcIik7XG5jb25zdCBzdHViID0gaW5pdC5zdHViO1xuY29uc3QgcmVxID0gaW5pdC5yZXE7XG5jb25zdCBJbWFnZUltcG9ydCA9IGluaXQuSW1hZ2VJbXBvcnQ7XG5cbnRhcC50ZXN0KFwiZ2V0VVJMXCIsIHthdXRvZW5kOiB0cnVlfSwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2goKTtcbiAgICB0LmVxdWFsKGJhdGNoLmdldFVSTChyZXEubGFuZyksXG4gICAgICAgIFwiL2FydHdvcmtzL3NvdXJjZS90ZXN0L2FkbWluP2ltYWdlcz10ZXN0L3N0YXJ0ZWRcIixcbiAgICAgICAgXCJHZXQgVVJMXCIpO1xufSk7XG5cbnRhcC50ZXN0KFwiZ2V0U291cmNlXCIsIHthdXRvZW5kOiB0cnVlfSwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2goKTtcbiAgICBjb25zdCBzb3VyY2UgPSBpbml0LmdldFNvdXJjZSgpO1xuICAgIHQuZXF1YWwoYmF0Y2guZ2V0U291cmNlKCksIHNvdXJjZSwgXCJHZXQgU291cmNlXCIpO1xufSk7XG5cbnRhcC50ZXN0KFwiZ2V0Q3VyU3RhdGVcIiwge2F1dG9lbmQ6IHRydWV9LCAodCkgPT4ge1xuICAgIGNvbnN0IGJhdGNoID0gaW5pdC5nZXRCYXRjaCgpO1xuICAgIGNvbnN0IHN0YXRlID0gYmF0Y2guZ2V0Q3VyU3RhdGUoKTtcbiAgICB0LmVxdWFsKHN0YXRlLmlkLCBcInN0YXJ0ZWRcIiwgXCJHZXQgU3RhdGUgSURcIik7XG4gICAgdC5lcXVhbChzdGF0ZS5uYW1lKHJlcSksIFwiQXdhaXRpbmcgcHJvY2Vzc2luZy4uLlwiLCBcIkdldCBTdGF0ZSBOYW1lXCIpO1xufSk7XG5cbnRhcC50ZXN0KFwiZ2V0TmV4dFN0YXRlXCIsIHthdXRvZW5kOiB0cnVlfSwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2goKTtcbiAgICBjb25zdCBzdGF0ZSA9IGJhdGNoLmdldE5leHRTdGF0ZSgpO1xuICAgIHQuZXF1YWwoc3RhdGUuaWQsIFwicHJvY2Vzcy5zdGFydGVkXCIsIFwiR2V0IFN0YXRlIElEXCIpO1xuICAgIHQuZXF1YWwoc3RhdGUubmFtZShyZXEpLCBcIlByb2Nlc3NpbmcuLi5cIiwgXCJHZXQgU3RhdGUgTmFtZVwiKTtcbn0pO1xuXG50YXAudGVzdChcImNhbkFkdmFuY2VcIiwge2F1dG9lbmQ6IHRydWV9LCAodCkgPT4ge1xuICAgIGNvbnN0IGJhdGNoID0gaW5pdC5nZXRCYXRjaCgpO1xuICAgIHQuZXF1YWwoYmF0Y2guY2FuQWR2YW5jZSgpLCB0cnVlLCBcIkNoZWNrIGlmIHN0YXRlIGNhbiBhZHZhbmNlXCIpO1xufSk7XG5cbnRhcC50ZXN0KFwic2F2ZVN0YXRlXCIsICh0KSA9PiB7XG4gICAgY29uc3QgYmF0Y2ggPSBpbml0LmdldEJhdGNoKCk7XG4gICAgYmF0Y2guc2F2ZVN0YXRlKFwicHJvY2Vzcy5zdGFydGVkXCIsICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBiYXRjaC5nZXRDdXJTdGF0ZSgpO1xuICAgICAgICB0LmVxdWFsKHN0YXRlLmlkLCBcInByb2Nlc3Muc3RhcnRlZFwiLCBcIkdldCBTdGF0ZSBJRFwiKTtcbiAgICAgICAgdC5lcXVhbChzdGF0ZS5uYW1lKHJlcSksIFwiUHJvY2Vzc2luZy4uLlwiLCBcIkdldCBTdGF0ZSBOYW1lXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwiZ2V0RXJyb3JcIiwge2F1dG9lbmQ6IHRydWV9LCAodCkgPT4ge1xuICAgIGNvbnN0IGJhdGNoID0gaW5pdC5nZXRCYXRjaCgpO1xuICAgIGNvbnN0IGVycm9ycyA9IFtcIkVSUk9SX1JFQURJTkdfWklQXCIsIFwiWklQX0ZJTEVfRU1QVFlcIiwgXCJNQUxGT1JNRURfSU1BR0VcIixcbiAgICAgICAgXCJFTVBUWV9JTUFHRVwiLCBcIk5FV19WRVJTSU9OXCIsIFwiVE9PX1NNQUxMXCIsIFwiRVJST1JfU0FWSU5HXCJdO1xuICAgIGZvciAoY29uc3QgZXJyb3Igb2YgZXJyb3JzKSB7XG4gICAgICAgIGJhdGNoLmVycm9yID0gZXJyb3I7XG4gICAgICAgIHQub2soSW1hZ2VJbXBvcnQuZ2V0RXJyb3IocmVxLCBiYXRjaC5lcnJvciksIGVycm9yKTtcbiAgICAgICAgdC5ub3RFcXVhbChJbWFnZUltcG9ydC5nZXRFcnJvcihyZXEsIGJhdGNoLmVycm9yKSwgZXJyb3IsIGVycm9yKTtcbiAgICB9XG59KTtcblxudGFwLnRlc3QoXCJnZXRGaWx0ZXJlZFJlc3VsdHNcIiwge2F1dG9lbmQ6IHRydWV9LCAodCkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBpbml0LmdldEJhdGNoZXMoKVxuICAgICAgICAubWFwKChiYXRjaCkgPT4gYmF0Y2guZ2V0RmlsdGVyZWRSZXN1bHRzKCkpO1xuICAgIHQuc2FtZShyZXN1bHRzWzBdLCB7XG4gICAgICAgIGVycm9yczogW10sXG4gICAgICAgIG1vZGVsczogW10sXG4gICAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICB9KTtcbiAgICB0LnNhbWUocmVzdWx0c1syXSwge1xuICAgICAgICBcImVycm9yc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJfaWRcIjogXCJjb3JydXB0ZWQuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJlcnJvclwiOiBcIk1BTEZPUk1FRF9JTUFHRVwiLFxuICAgICAgICAgICAgICAgIFwiZmlsZU5hbWVcIjogXCJjb3JydXB0ZWQuanBnXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwiZW1wdHkuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJlcnJvclwiOiBcIkVNUFRZX0lNQUdFXCIsXG4gICAgICAgICAgICAgICAgXCJmaWxlTmFtZVwiOiBcImVtcHR5LmpwZ1wiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgXCJtb2RlbHNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwiYmFyLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwiZmlsZU5hbWVcIjogXCJiYXIuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJtb2RlbFwiOiBcInRlc3QvYmFyLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwid2FybmluZ3NcIjogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwiZm9vLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwiZmlsZU5hbWVcIjogXCJmb28uanBnXCIsXG4gICAgICAgICAgICAgICAgXCJtb2RlbFwiOiBcInRlc3QvZm9vLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwid2FybmluZ3NcIjogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwibmV3MS5qcGdcIixcbiAgICAgICAgICAgICAgICBcImZpbGVOYW1lXCI6IFwibmV3MS5qcGdcIixcbiAgICAgICAgICAgICAgICBcIm1vZGVsXCI6IFwidGVzdC9uZXcxLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwid2FybmluZ3NcIjogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwibmV3Mi5qcGdcIixcbiAgICAgICAgICAgICAgICBcImZpbGVOYW1lXCI6IFwibmV3Mi5qcGdcIixcbiAgICAgICAgICAgICAgICBcIm1vZGVsXCI6IFwidGVzdC9uZXcyLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwid2FybmluZ3NcIjogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwic21hbGwuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJmaWxlTmFtZVwiOiBcInNtYWxsLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwibW9kZWxcIjogXCJ0ZXN0L3NtYWxsLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwid2FybmluZ3NcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIk5FV19WRVJTSU9OXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiVE9PX1NNQUxMXCIsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJfaWRcIjogXCJuZXczLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwiZmlsZU5hbWVcIjogXCJuZXczLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwibW9kZWxcIjogXCJ0ZXN0L25ldzMuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJ3YXJuaW5nc1wiOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJfaWRcIjogXCJub3NpbWlsYXIuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJmaWxlTmFtZVwiOiBcIm5vc2ltaWxhci5qcGdcIixcbiAgICAgICAgICAgICAgICBcIm1vZGVsXCI6IFwidGVzdC9ub3NpbWlsYXIuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJ3YXJuaW5nc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiTkVXX1ZFUlNJT05cIixcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgXCJ3YXJuaW5nc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJfaWRcIjogXCJzbWFsbC5qcGdcIixcbiAgICAgICAgICAgICAgICBcImZpbGVOYW1lXCI6IFwic21hbGwuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJtb2RlbFwiOiBcInRlc3Qvc21hbGwuanBnXCIsXG4gICAgICAgICAgICAgICAgXCJ3YXJuaW5nc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiTkVXX1ZFUlNJT05cIixcbiAgICAgICAgICAgICAgICAgICAgXCJUT09fU01BTExcIixcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcIl9pZFwiOiBcIm5vc2ltaWxhci5qcGdcIixcbiAgICAgICAgICAgICAgICBcImZpbGVOYW1lXCI6IFwibm9zaW1pbGFyLmpwZ1wiLFxuICAgICAgICAgICAgICAgIFwibW9kZWxcIjogXCJ0ZXN0L25vc2ltaWxhci5qcGdcIixcbiAgICAgICAgICAgICAgICBcIndhcm5pbmdzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJORVdfVkVSU0lPTlwiLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0pO1xuICAgIHQuc2FtZShyZXN1bHRzWzVdLCB7XG4gICAgICAgIGVycm9yczogW10sXG4gICAgICAgIG1vZGVsczogW10sXG4gICAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICB9KTtcbn0pO1xuXG50YXAudGVzdChcInZhbGlkYXRlXCIsICh0KSA9PiB7XG4gICAgY29uc3QgdGVzdFppcCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBcInRlc3REYXRhXCIsIFwiY29ycnVwdGVkLnppcFwiKTtcblxuICAgIGNvbnN0IGJhdGNoID0gbmV3IEltYWdlSW1wb3J0KHtcbiAgICAgICAgX2lkOiBcInRlc3QvY29ycnVwdGVkXCIsXG4gICAgICAgIHNvdXJjZTogXCJ0ZXN0XCIsXG4gICAgICAgIHppcEZpbGU6IHRlc3RaaXAsXG4gICAgICAgIGZpbGVOYW1lOiBcImNvcnJ1cHRlZC56aXBcIixcbiAgICB9KTtcblxuICAgIGJhdGNoLnZhbGlkYXRlKChlcnIpID0+IHtcbiAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdC5lcXVhbChiYXRjaC5faWQsIFwidGVzdC9jb3JydXB0ZWRcIiwgXCJJRCBzaG91bGQgbWF0Y2hcIik7XG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxudGFwLnRlc3QoXCJ2YWxpZGF0ZVwiLCAodCkgPT4ge1xuICAgIGNvbnN0IHRlc3RaaXAgPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgXCJ0ZXN0RGF0YVwiLCBcImNvcnJ1cHRlZC56aXBcIik7XG5cbiAgICBjb25zdCBiYXRjaCA9IG5ldyBJbWFnZUltcG9ydCh7XG4gICAgICAgIHNvdXJjZTogXCJ0ZXN0XCIsXG4gICAgICAgIHppcEZpbGU6IHRlc3RaaXAsXG4gICAgICAgIGZpbGVOYW1lOiBcImNvcnJ1cHRlZC56aXBcIixcbiAgICB9KTtcblxuICAgIGJhdGNoLnZhbGlkYXRlKChlcnIpID0+IHtcbiAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdC5vayhiYXRjaC5faWQsIFwiU2hvdWxkIGhhdmUgYW4gSUQuXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlc1wiLCAodCkgPT4ge1xuICAgIGNvbnN0IGJhdGNoID0gaW5pdC5nZXRCYXRjaCgpO1xuICAgIGJhdGNoLnByb2Nlc3NJbWFnZXMoKGVycikgPT4ge1xuICAgICAgICB0LmVycm9yKGVyciwgXCJFcnJvciBzaG91bGQgYmUgZW1wdHkuXCIpO1xuXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkID0gaW5pdC5nZXRJbWFnZVJlc3VsdHNEYXRhKCk7XG5cbiAgICAgICAgdC5lcXVhbChiYXRjaC5yZXN1bHRzLmxlbmd0aCwgZXhwZWN0ZWQubGVuZ3RoKTtcbiAgICAgICAgZXhwZWN0ZWQuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICAgICAgdC5zYW1lKGJhdGNoLnJlc3VsdHNbaV0sIGl0ZW0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlcyAoQ29ycnVwdGVkIEZpbGUpXCIsICh0KSA9PiB7XG4gICAgY29uc3QgdGVzdFppcCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBcInRlc3REYXRhXCIsIFwiY29ycnVwdGVkLnppcFwiKTtcblxuICAgIGNvbnN0IGJhdGNoID0gbmV3IEltYWdlSW1wb3J0KHtcbiAgICAgICAgX2lkOiBcInRlc3Qvc3RhcnRlZFwiLFxuICAgICAgICBzb3VyY2U6IFwidGVzdFwiLFxuICAgICAgICB6aXBGaWxlOiB0ZXN0WmlwLFxuICAgICAgICBmaWxlTmFtZTogXCJjb3JydXB0ZWQuemlwXCIsXG4gICAgfSk7XG5cbiAgICBiYXRjaC5wcm9jZXNzSW1hZ2VzKChlcnIpID0+IHtcbiAgICAgICAgdC5vayhlcnIsIFwiRXhwZWN0aW5nIGFuIGVycm9yXCIpO1xuICAgICAgICB0LmVxdWFsKGVyci5tZXNzYWdlLCBcIkVSUk9SX1JFQURJTkdfWklQXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlcyAoRW1wdHkgRmlsZSlcIiwgKHQpID0+IHtcbiAgICBjb25zdCB0ZXN0WmlwID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIFwidGVzdERhdGFcIiwgXCJlbXB0eS56aXBcIik7XG5cbiAgICBjb25zdCBiYXRjaCA9IG5ldyBJbWFnZUltcG9ydCh7XG4gICAgICAgIF9pZDogXCJ0ZXN0L3N0YXJ0ZWRcIixcbiAgICAgICAgc291cmNlOiBcInRlc3RcIixcbiAgICAgICAgemlwRmlsZTogdGVzdFppcCxcbiAgICAgICAgZmlsZU5hbWU6IFwiZW1wdHkuemlwXCIsXG4gICAgfSk7XG5cbiAgICBiYXRjaC5wcm9jZXNzSW1hZ2VzKChlcnIpID0+IHtcbiAgICAgICAgdC5vayhlcnIsIFwiRXhwZWN0aW5nIGFuIGVycm9yXCIpO1xuICAgICAgICB0LmVxdWFsKGVyci5tZXNzYWdlLCBcIlpJUF9GSUxFX0VNUFRZXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlcyAoYWR2YW5jZSwgc3RhcnRlZClcIiwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2goKTtcbiAgICB0LmVxdWFsKGJhdGNoLmdldEN1clN0YXRlKCkubmFtZShyZXEpLCBcIkF3YWl0aW5nIHByb2Nlc3NpbmcuLi5cIik7XG4gICAgYmF0Y2guYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgIHQuZXJyb3IoZXJyLCBcIkVycm9yIHNob3VsZCBiZSBlbXB0eS5cIik7XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBpbml0LmdldEltYWdlUmVzdWx0c0RhdGEoKTtcblxuICAgICAgICB0LmVxdWFsKGJhdGNoLnJlc3VsdHMubGVuZ3RoLCBleHBlY3RlZC5sZW5ndGgpO1xuICAgICAgICBleHBlY3RlZC5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgICAgICB0LnNhbWUoYmF0Y2gucmVzdWx0c1tpXSwgaXRlbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIFwicHJvY2Vzcy5jb21wbGV0ZWRcIik7XG5cbiAgICAgICAgdC5lbmQoKTtcbiAgICB9KTtcbn0pO1xuXG50YXAudGVzdChcInByb2Nlc3NJbWFnZXMgKGFkdmFuY2UsIHByb2Nlc3Muc3RhcnRlZClcIiwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2hlcygpWzFdO1xuICAgIHQuZXF1YWwoYmF0Y2guZ2V0Q3VyU3RhdGUoKS5uYW1lKHJlcSksIFwiUHJvY2Vzc2luZy4uLlwiKTtcbiAgICBiYXRjaC5hZHZhbmNlKChlcnIpID0+IHtcbiAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdC5lcXVhbChiYXRjaC5yZXN1bHRzLmxlbmd0aCwgMCk7XG4gICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIFwicHJvY2Vzcy5zdGFydGVkXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlcyAoYWR2YW5jZSwgcHJvY2Vzcy5jb21wbGV0ZWQpXCIsICh0KSA9PiB7XG4gICAgY29uc3QgYmF0Y2ggPSBpbml0LmdldEJhdGNoZXMoKVsyXTtcbiAgICB0LmVxdWFsKGJhdGNoLmdldEN1clN0YXRlKCkubmFtZShyZXEpLCBcIkNvbXBsZXRlZC5cIik7XG4gICAgYmF0Y2guYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgIHQuZXJyb3IoZXJyLCBcIkVycm9yIHNob3VsZCBiZSBlbXB0eS5cIik7XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBpbml0LmdldEltYWdlUmVzdWx0c0RhdGEoKTtcblxuICAgICAgICB0LmVxdWFsKGJhdGNoLnJlc3VsdHMubGVuZ3RoLCBleHBlY3RlZC5sZW5ndGgpO1xuICAgICAgICBleHBlY3RlZC5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgICAgICB0LnNhbWUoYmF0Y2gucmVzdWx0c1tpXSwgaXRlbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIFwiY29tcGxldGVkXCIpO1xuXG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxudGFwLnRlc3QoXCJwcm9jZXNzSW1hZ2VzIChhZHZhbmNlLCBjb21wbGV0ZWQpXCIsICh0KSA9PiB7XG4gICAgY29uc3QgYmF0Y2ggPSBpbml0LmdldEJhdGNoZXMoKVs0XTtcbiAgICB0LmVxdWFsKGJhdGNoLmdldEN1clN0YXRlKCkubmFtZShyZXEpLCBcIkNvbXBsZXRlZC5cIik7XG4gICAgYmF0Y2guYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgIHQuZXJyb3IoZXJyLCBcIkVycm9yIHNob3VsZCBiZSBlbXB0eS5cIik7XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBpbml0LmdldEltYWdlUmVzdWx0c0RhdGEoKTtcblxuICAgICAgICB0LmVxdWFsKGJhdGNoLnJlc3VsdHMubGVuZ3RoLCBleHBlY3RlZC5sZW5ndGgpO1xuICAgICAgICBleHBlY3RlZC5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgICAgICB0LnNhbWUoYmF0Y2gucmVzdWx0c1tpXSwgaXRlbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIFwiY29tcGxldGVkXCIpO1xuXG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxudGFwLnRlc3QoXCJwcm9jZXNzSW1hZ2VzIChhZHZhbmNlLCBlcnJvcilcIiwgKHQpID0+IHtcbiAgICBjb25zdCBiYXRjaCA9IGluaXQuZ2V0QmF0Y2hlcygpWzVdO1xuICAgIHQubm90T2soYmF0Y2guZ2V0Q3VyU3RhdGUoKSk7XG4gICAgYmF0Y2guYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgIHQuZXJyb3IoZXJyLCBcIkVycm9yIHNob3VsZCBiZSBlbXB0eS5cIik7XG4gICAgICAgIHQuZXF1YWwoYmF0Y2gucmVzdWx0cy5sZW5ndGgsIDApO1xuICAgICAgICB0LmVxdWFsKGJhdGNoLnN0YXRlLCBcImVycm9yXCIpO1xuICAgICAgICB0LmVuZCgpO1xuICAgIH0pO1xufSk7XG5cbnRhcC50ZXN0KFwicHJvY2Vzc0ltYWdlcyAoYWR2YW5jZSwgQ29ycnVwdGVkIEZpbGUpXCIsICh0KSA9PiB7XG4gICAgY29uc3QgdGVzdFppcCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBcInRlc3REYXRhXCIsIFwiY29ycnVwdGVkLnppcFwiKTtcblxuICAgIGNvbnN0IGJhdGNoID0gbmV3IEltYWdlSW1wb3J0KHtcbiAgICAgICAgX2lkOiBcInRlc3Qvc3RhcnRlZFwiLFxuICAgICAgICBzb3VyY2U6IFwidGVzdFwiLFxuICAgICAgICB6aXBGaWxlOiB0ZXN0WmlwLFxuICAgICAgICBmaWxlTmFtZTogXCJjb3JydXB0ZWQuemlwXCIsXG4gICAgfSk7XG5cbiAgICBzdHViKGJhdGNoLCBcInNhdmVcIiwgcHJvY2Vzcy5uZXh0VGljayk7XG5cbiAgICBiYXRjaC5hZHZhbmNlKChlcnIpID0+IHtcbiAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdC5lcXVhbChiYXRjaC5lcnJvciwgXCJFUlJPUl9SRUFESU5HX1pJUFwiKTtcbiAgICAgICAgdC5lcXVhbChiYXRjaC5yZXN1bHRzLmxlbmd0aCwgMCk7XG4gICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIFwiZXJyb3JcIik7XG4gICAgICAgIHQuZW5kKCk7XG4gICAgfSk7XG59KTtcblxuLy8gTk9URShqZXJlc2lnKTogRGlzYWJsZWQgYXMgdGhleSBpbnRlcm1pdHRlbnRseSBmYWlsIG9uIFRyYXZpcyBDSVxuLypcbi8vIE5PVEUoamVyZXNpZyk6IEluY3JlYXNlIHRoZSB0aW1lb3V0IGFzIHRoaXMgdGVzdCBjYW4gdGFrZSBhIHdoaWxlIHRvIHJ1blxudGFwLnRlc3QoXCJJbWFnZUltcG9ydC5hZHZhbmNlXCIsIHt0aW1lb3V0OiAyMDAwMH0sICh0KSA9PiB7XG4gICAgY29uc3QgY2hlY2tTdGF0ZXMgPSAoYmF0Y2hlcywgc3RhdGVzKSA9PiB7XG4gICAgICAgIHQuZXF1YWwoYmF0Y2hlcy5sZW5ndGgsIHN0YXRlcy5sZW5ndGgpO1xuICAgICAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIGJhdGNoZXMpIHtcbiAgICAgICAgICAgIHQuZXF1YWwoYmF0Y2guc3RhdGUsIHN0YXRlcy5zaGlmdCgpKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBnZXRCYXRjaGVzID0gKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIEltYWdlSW1wb3J0LmZpbmQoe30sIFwiXCIsIHt9LCAoZXJyLCBiYXRjaGVzKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBiYXRjaGVzLmZpbHRlcigoYmF0Y2gpID0+IChiYXRjaC5zdGF0ZSAhPT0gXCJlcnJvclwiICYmXG4gICAgICAgICAgICAgICAgYmF0Y2guc3RhdGUgIT09IFwiY29tcGxldGVkXCIpKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBnZXRCYXRjaGVzKChlcnIsIGJhdGNoZXMpID0+IHtcbiAgICAgICAgY2hlY2tTdGF0ZXMoYmF0Y2hlcyxcbiAgICAgICAgICAgIFtcInN0YXJ0ZWRcIiwgXCJwcm9jZXNzLnN0YXJ0ZWRcIiwgXCJwcm9jZXNzLmNvbXBsZXRlZFwiLFxuICAgICAgICAgICAgICAgIFwicHJvY2Vzcy5jb21wbGV0ZWRcIl0pO1xuXG4gICAgICAgIEltYWdlSW1wb3J0LmFkdmFuY2UoKGVycikgPT4ge1xuICAgICAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcblxuICAgICAgICAgICAgZ2V0QmF0Y2hlcygoZXJyLCBiYXRjaGVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY2hlY2tTdGF0ZXMoYmF0Y2hlcywgW1wicHJvY2Vzcy5jb21wbGV0ZWRcIiwgXCJwcm9jZXNzLnN0YXJ0ZWRcIl0pO1xuXG4gICAgICAgICAgICAgICAgSW1hZ2VJbXBvcnQuYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQuZXJyb3IoZXJyLCBcIkVycm9yIHNob3VsZCBiZSBlbXB0eS5cIik7XG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0QmF0Y2hlcygoZXJyLCBiYXRjaGVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja1N0YXRlcyhiYXRjaGVzLCBbXCJwcm9jZXNzLnN0YXJ0ZWRcIl0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JjZSBhbGwgYmF0Y2hlcyB0byBiZSBjb21wbGV0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQuZ2V0QmF0Y2hlcygpWzFdLnN0YXRlID0gXCJjb21wbGV0ZWRcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VJbXBvcnQuYWR2YW5jZSgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5lcnJvcihlcnIsIFwiRXJyb3Igc2hvdWxkIGJlIGVtcHR5LlwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEJhdGNoZXMoKGVyciwgYmF0Y2hlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja1N0YXRlcyhiYXRjaGVzLCBbXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiovXG4iXX0=