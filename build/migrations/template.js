"use strict";

var async = require("async");

var init = require("../lib/init");
var options = require("../lib/options");
var record = require("../lib/record");

exports.up = function (next) {
    init(function () {
        async.eachLimit(Object.keys(options.types), 1, function (type, callback) {
            record(type).find({}, {}, { timeout: true }).stream().on("data", function (record) {
                this.pause();

                console.log("Migrating " + record._id + "...");

                this.resume();
            }).on("close", callback);
        }, next);
    });
};

exports.down = function (next) {
    next();
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWdyYXRpb25zL3RlbXBsYXRlLmpzIl0sIm5hbWVzIjpbImFzeW5jIiwicmVxdWlyZSIsImluaXQiLCJvcHRpb25zIiwicmVjb3JkIiwiZXhwb3J0cyIsInVwIiwibmV4dCIsImVhY2hMaW1pdCIsIk9iamVjdCIsImtleXMiLCJ0eXBlcyIsInR5cGUiLCJjYWxsYmFjayIsImZpbmQiLCJ0aW1lb3V0Iiwic3RyZWFtIiwib24iLCJwYXVzZSIsImNvbnNvbGUiLCJsb2ciLCJfaWQiLCJyZXN1bWUiLCJkb3duIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLFFBQVFDLFFBQVEsT0FBUixDQUFkOztBQUVBLElBQU1DLE9BQU9ELFFBQVEsYUFBUixDQUFiO0FBQ0EsSUFBTUUsVUFBVUYsUUFBUSxnQkFBUixDQUFoQjtBQUNBLElBQU1HLFNBQVNILFFBQVEsZUFBUixDQUFmOztBQUVBSSxRQUFRQyxFQUFSLEdBQWEsVUFBQ0MsSUFBRCxFQUFVO0FBQ25CTCxTQUFLLFlBQU07QUFDUEYsY0FBTVEsU0FBTixDQUFnQkMsT0FBT0MsSUFBUCxDQUFZUCxRQUFRUSxLQUFwQixDQUFoQixFQUE0QyxDQUE1QyxFQUErQyxVQUFDQyxJQUFELEVBQU9DLFFBQVAsRUFBb0I7QUFDL0RULG1CQUFPUSxJQUFQLEVBQWFFLElBQWIsQ0FBa0IsRUFBbEIsRUFBc0IsRUFBdEIsRUFBMEIsRUFBQ0MsU0FBUyxJQUFWLEVBQTFCLEVBQTJDQyxNQUEzQyxHQUNLQyxFQURMLENBQ1EsTUFEUixFQUNnQixVQUFTYixNQUFULEVBQWlCO0FBQ3pCLHFCQUFLYyxLQUFMOztBQUVBQyx3QkFBUUMsR0FBUixnQkFBeUJoQixPQUFPaUIsR0FBaEM7O0FBRUEscUJBQUtDLE1BQUw7QUFDSCxhQVBMLEVBUUtMLEVBUkwsQ0FRUSxPQVJSLEVBUWlCSixRQVJqQjtBQVNILFNBVkQsRUFVR04sSUFWSDtBQVdILEtBWkQ7QUFhSCxDQWREOztBQWdCQUYsUUFBUWtCLElBQVIsR0FBZSxVQUFDaEIsSUFBRCxFQUFVO0FBQ3JCQTtBQUNILENBRkQiLCJmaWxlIjoidGVtcGxhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBhc3luYyA9IHJlcXVpcmUoXCJhc3luY1wiKTtcblxuY29uc3QgaW5pdCA9IHJlcXVpcmUoXCIuLi9saWIvaW5pdFwiKTtcbmNvbnN0IG9wdGlvbnMgPSByZXF1aXJlKFwiLi4vbGliL29wdGlvbnNcIik7XG5jb25zdCByZWNvcmQgPSByZXF1aXJlKFwiLi4vbGliL3JlY29yZFwiKTtcblxuZXhwb3J0cy51cCA9IChuZXh0KSA9PiB7XG4gICAgaW5pdCgoKSA9PiB7XG4gICAgICAgIGFzeW5jLmVhY2hMaW1pdChPYmplY3Qua2V5cyhvcHRpb25zLnR5cGVzKSwgMSwgKHR5cGUsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICByZWNvcmQodHlwZSkuZmluZCh7fSwge30sIHt0aW1lb3V0OiB0cnVlfSkuc3RyZWFtKClcbiAgICAgICAgICAgICAgICAub24oXCJkYXRhXCIsIGZ1bmN0aW9uKHJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE1pZ3JhdGluZyAke3JlY29yZC5faWR9Li4uYCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bWUoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbihcImNsb3NlXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgfSwgbmV4dCk7XG4gICAgfSk7XG59O1xuXG5leHBvcnRzLmRvd24gPSAobmV4dCkgPT4ge1xuICAgIG5leHQoKTtcbn07XG4iXX0=