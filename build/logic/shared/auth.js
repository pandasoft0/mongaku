"use strict";

var passport = require("passport");

var urls = require("../../lib/urls");

// Only allow certain users to access these pages
module.exports = function (req, res, next) {
    passport.authenticate("local", function () {
        if (!req.user) {
            req.session.redirectTo = req.originalUrl;
            res.redirect(urls.gen(req.lang, "/login"));
        } else if (!req.user.siteAdmin && req.user.sourceAdmin.indexOf(req.params.source) < 0) {
            next(new Error(req.gettext("Authorization required.")));
        } else {
            next();
        }
    })(req, res, next);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9sb2dpYy9zaGFyZWQvYXV0aC5qcyJdLCJuYW1lcyI6WyJwYXNzcG9ydCIsInJlcXVpcmUiLCJ1cmxzIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcSIsInJlcyIsIm5leHQiLCJhdXRoZW50aWNhdGUiLCJ1c2VyIiwic2Vzc2lvbiIsInJlZGlyZWN0VG8iLCJvcmlnaW5hbFVybCIsInJlZGlyZWN0IiwiZ2VuIiwibGFuZyIsInNpdGVBZG1pbiIsInNvdXJjZUFkbWluIiwiaW5kZXhPZiIsInBhcmFtcyIsInNvdXJjZSIsIkVycm9yIiwiZ2V0dGV4dCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxXQUFXQyxRQUFRLFVBQVIsQ0FBakI7O0FBRUEsSUFBTUMsT0FBT0QsUUFBUSxnQkFBUixDQUFiOztBQUVBO0FBQ0FFLE9BQU9DLE9BQVAsR0FBaUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7QUFDakNQLGFBQVNRLFlBQVQsQ0FBc0IsT0FBdEIsRUFBK0IsWUFBTTtBQUNqQyxZQUFJLENBQUNILElBQUlJLElBQVQsRUFBZTtBQUNYSixnQkFBSUssT0FBSixDQUFZQyxVQUFaLEdBQXlCTixJQUFJTyxXQUE3QjtBQUNBTixnQkFBSU8sUUFBSixDQUFhWCxLQUFLWSxHQUFMLENBQVNULElBQUlVLElBQWIsRUFBbUIsUUFBbkIsQ0FBYjtBQUNILFNBSEQsTUFHTyxJQUFJLENBQUNWLElBQUlJLElBQUosQ0FBU08sU0FBVixJQUF1QlgsSUFBSUksSUFBSixDQUFTUSxXQUFULENBQ3pCQyxPQUR5QixDQUNqQmIsSUFBSWMsTUFBSixDQUFXQyxNQURNLElBQ0ksQ0FEL0IsRUFDa0M7QUFDckNiLGlCQUFLLElBQUljLEtBQUosQ0FBVWhCLElBQUlpQixPQUFKLENBQVkseUJBQVosQ0FBVixDQUFMO0FBQ0gsU0FITSxNQUdBO0FBQ0hmO0FBQ0g7QUFDSixLQVZELEVBVUdGLEdBVkgsRUFVUUMsR0FWUixFQVVhQyxJQVZiO0FBV0gsQ0FaRCIsImZpbGUiOiJhdXRoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGFzc3BvcnQgPSByZXF1aXJlKFwicGFzc3BvcnRcIik7XG5cbmNvbnN0IHVybHMgPSByZXF1aXJlKFwiLi4vLi4vbGliL3VybHNcIik7XG5cbi8vIE9ubHkgYWxsb3cgY2VydGFpbiB1c2VycyB0byBhY2Nlc3MgdGhlc2UgcGFnZXNcbm1vZHVsZS5leHBvcnRzID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgcGFzc3BvcnQuYXV0aGVudGljYXRlKFwibG9jYWxcIiwgKCkgPT4ge1xuICAgICAgICBpZiAoIXJlcS51c2VyKSB7XG4gICAgICAgICAgICByZXEuc2Vzc2lvbi5yZWRpcmVjdFRvID0gcmVxLm9yaWdpbmFsVXJsO1xuICAgICAgICAgICAgcmVzLnJlZGlyZWN0KHVybHMuZ2VuKHJlcS5sYW5nLCBcIi9sb2dpblwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXJlcS51c2VyLnNpdGVBZG1pbiAmJiByZXEudXNlci5zb3VyY2VBZG1pblxuICAgICAgICAgICAgICAgIC5pbmRleE9mKHJlcS5wYXJhbXMuc291cmNlKSA8IDApIHtcbiAgICAgICAgICAgIG5leHQobmV3IEVycm9yKHJlcS5nZXR0ZXh0KFwiQXV0aG9yaXphdGlvbiByZXF1aXJlZC5cIikpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfVxuICAgIH0pKHJlcSwgcmVzLCBuZXh0KTtcbn07XG4iXX0=