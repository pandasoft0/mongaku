"use strict";

var qs = require("querystring");

var urls = require("../../lib/urls");
var queries = require("./queries");
var paramFilter = require("./param-filter");

var searchURL = function searchURL(req, query, keepSecondary) {
    var params = paramFilter(query, keepSecondary);
    var primary = params.primary;
    var type = query.type;
    var typeQueries = queries(type);
    var queryString = qs.stringify(params.all);
    var url = urls.gen(req.lang, "/" + type + "/search");

    if (primary.length === 1 && typeQueries[primary[0]].url) {
        queryString = qs.stringify(params.secondary);
        url = typeQueries[primary[0]].url(query[primary[0]]);
        if (url.getURL) {
            url = url.getURL(req.lang);
        } else {
            url = urls.gen(req.lang, url);
        }
    }

    if (queryString) {
        var prefix = url.indexOf("?") >= 0 ? "&" : "?";
        queryString = "" + prefix + queryString;
    }

    return "" + url + queryString;
};

module.exports = searchURL;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9sb2dpYy9zaGFyZWQvc2VhcmNoLXVybC5qcyJdLCJuYW1lcyI6WyJxcyIsInJlcXVpcmUiLCJ1cmxzIiwicXVlcmllcyIsInBhcmFtRmlsdGVyIiwic2VhcmNoVVJMIiwicmVxIiwicXVlcnkiLCJrZWVwU2Vjb25kYXJ5IiwicGFyYW1zIiwicHJpbWFyeSIsInR5cGUiLCJ0eXBlUXVlcmllcyIsInF1ZXJ5U3RyaW5nIiwic3RyaW5naWZ5IiwiYWxsIiwidXJsIiwiZ2VuIiwibGFuZyIsImxlbmd0aCIsInNlY29uZGFyeSIsImdldFVSTCIsInByZWZpeCIsImluZGV4T2YiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLEtBQUtDLFFBQVEsYUFBUixDQUFYOztBQUVBLElBQU1DLE9BQU9ELFFBQVEsZ0JBQVIsQ0FBYjtBQUNBLElBQU1FLFVBQVVGLFFBQVEsV0FBUixDQUFoQjtBQUNBLElBQU1HLGNBQWNILFFBQVEsZ0JBQVIsQ0FBcEI7O0FBRUEsSUFBTUksWUFBWSxTQUFaQSxTQUFZLENBQUNDLEdBQUQsRUFBTUMsS0FBTixFQUFhQyxhQUFiLEVBQStCO0FBQzdDLFFBQU1DLFNBQVNMLFlBQVlHLEtBQVosRUFBbUJDLGFBQW5CLENBQWY7QUFDQSxRQUFNRSxVQUFVRCxPQUFPQyxPQUF2QjtBQUNBLFFBQU1DLE9BQU9KLE1BQU1JLElBQW5CO0FBQ0EsUUFBTUMsY0FBY1QsUUFBUVEsSUFBUixDQUFwQjtBQUNBLFFBQUlFLGNBQWNiLEdBQUdjLFNBQUgsQ0FBYUwsT0FBT00sR0FBcEIsQ0FBbEI7QUFDQSxRQUFJQyxNQUFNZCxLQUFLZSxHQUFMLENBQVNYLElBQUlZLElBQWIsUUFBdUJQLElBQXZCLGFBQVY7O0FBRUEsUUFBSUQsUUFBUVMsTUFBUixLQUFtQixDQUFuQixJQUF3QlAsWUFBWUYsUUFBUSxDQUFSLENBQVosRUFBd0JNLEdBQXBELEVBQXlEO0FBQ3JESCxzQkFBY2IsR0FBR2MsU0FBSCxDQUFhTCxPQUFPVyxTQUFwQixDQUFkO0FBQ0FKLGNBQU1KLFlBQVlGLFFBQVEsQ0FBUixDQUFaLEVBQXdCTSxHQUF4QixDQUE0QlQsTUFBTUcsUUFBUSxDQUFSLENBQU4sQ0FBNUIsQ0FBTjtBQUNBLFlBQUlNLElBQUlLLE1BQVIsRUFBZ0I7QUFDWkwsa0JBQU1BLElBQUlLLE1BQUosQ0FBV2YsSUFBSVksSUFBZixDQUFOO0FBQ0gsU0FGRCxNQUVPO0FBQ0hGLGtCQUFNZCxLQUFLZSxHQUFMLENBQVNYLElBQUlZLElBQWIsRUFBbUJGLEdBQW5CLENBQU47QUFDSDtBQUNKOztBQUVELFFBQUlILFdBQUosRUFBaUI7QUFDYixZQUFNUyxTQUFTTixJQUFJTyxPQUFKLENBQVksR0FBWixLQUFvQixDQUFwQixHQUF3QixHQUF4QixHQUE4QixHQUE3QztBQUNBViwyQkFBaUJTLE1BQWpCLEdBQTBCVCxXQUExQjtBQUNIOztBQUVELGdCQUFVRyxHQUFWLEdBQWdCSCxXQUFoQjtBQUNILENBeEJEOztBQTBCQVcsT0FBT0MsT0FBUCxHQUFpQnBCLFNBQWpCIiwiZmlsZSI6InNlYXJjaC11cmwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBxcyA9IHJlcXVpcmUoXCJxdWVyeXN0cmluZ1wiKTtcblxuY29uc3QgdXJscyA9IHJlcXVpcmUoXCIuLi8uLi9saWIvdXJsc1wiKTtcbmNvbnN0IHF1ZXJpZXMgPSByZXF1aXJlKFwiLi9xdWVyaWVzXCIpO1xuY29uc3QgcGFyYW1GaWx0ZXIgPSByZXF1aXJlKFwiLi9wYXJhbS1maWx0ZXJcIik7XG5cbmNvbnN0IHNlYXJjaFVSTCA9IChyZXEsIHF1ZXJ5LCBrZWVwU2Vjb25kYXJ5KSA9PiB7XG4gICAgY29uc3QgcGFyYW1zID0gcGFyYW1GaWx0ZXIocXVlcnksIGtlZXBTZWNvbmRhcnkpO1xuICAgIGNvbnN0IHByaW1hcnkgPSBwYXJhbXMucHJpbWFyeTtcbiAgICBjb25zdCB0eXBlID0gcXVlcnkudHlwZTtcbiAgICBjb25zdCB0eXBlUXVlcmllcyA9IHF1ZXJpZXModHlwZSk7XG4gICAgbGV0IHF1ZXJ5U3RyaW5nID0gcXMuc3RyaW5naWZ5KHBhcmFtcy5hbGwpO1xuICAgIGxldCB1cmwgPSB1cmxzLmdlbihyZXEubGFuZywgYC8ke3R5cGV9L3NlYXJjaGApO1xuXG4gICAgaWYgKHByaW1hcnkubGVuZ3RoID09PSAxICYmIHR5cGVRdWVyaWVzW3ByaW1hcnlbMF1dLnVybCkge1xuICAgICAgICBxdWVyeVN0cmluZyA9IHFzLnN0cmluZ2lmeShwYXJhbXMuc2Vjb25kYXJ5KTtcbiAgICAgICAgdXJsID0gdHlwZVF1ZXJpZXNbcHJpbWFyeVswXV0udXJsKHF1ZXJ5W3ByaW1hcnlbMF1dKTtcbiAgICAgICAgaWYgKHVybC5nZXRVUkwpIHtcbiAgICAgICAgICAgIHVybCA9IHVybC5nZXRVUkwocmVxLmxhbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXJsID0gdXJscy5nZW4ocmVxLmxhbmcsIHVybCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocXVlcnlTdHJpbmcpIHtcbiAgICAgICAgY29uc3QgcHJlZml4ID0gdXJsLmluZGV4T2YoXCI/XCIpID49IDAgPyBcIiZcIiA6IFwiP1wiO1xuICAgICAgICBxdWVyeVN0cmluZyA9IGAke3ByZWZpeH0ke3F1ZXJ5U3RyaW5nfWA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGAke3VybH0ke3F1ZXJ5U3RyaW5nfWA7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHNlYXJjaFVSTDtcbiJdfQ==